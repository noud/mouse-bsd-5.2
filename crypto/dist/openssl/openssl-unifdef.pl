#! /usr/pkg/bin/perl
$tmp=tmpfile.$$;

$unifdef0 = <<EOF;
MAC_OS_pre_X
MSDOS
NO_ASN1_FIELD_NAMES
NO_ASN1_TYPEDEFS
NO_BF
NO_BIO
NO_BUFFER
NO_CAST
NO_COMP
NO_DES
NO_DH
NO_DSA
NO_ERR
NO_EVP
NO_FP_API
NO_HASH_COMP
NO_HMAC
NO_IDEA
NO_LHASH
NO_LOCKING
NO_MD2
NO_MD4
NO_MD5
NO_MDC2
NO_RC2
NO_RC4
NO_RC5
NO_RIPEMD
NO_RSA
NO_SHA
NO_SHA0
NO_SHA1
NO_SOCK
NO_SSL2
NO_SSL3
NO_STACK
NO_STDIO
NO_X509
NeXT
OPENSSL_NO_AES
OPENSSL_NO_BF
OPENSSL_NO_BIO
OPENSSL_NO_BUFFER
OPENSSL_NO_CAST
OPENSSL_NO_COMP
OPENSSL_NO_DES
OPENSSL_NO_DH
OPENSSL_NO_DSA
OPENSSL_NO_EC
OPENSSL_NO_ENGINE
OPENSSL_NO_ERR
OPENSSL_NO_EVP
OPENSSL_NO_FP_API
OPENSSL_NO_HASH_COMP
OPENSSL_NO_HMAC
OPENSSL_NO_IDEA
OPENSSL_NO_LHASH
OPENSSL_NO_LOCKING
OPENSSL_NO_MD2
OPENSSL_NO_MD4
OPENSSL_NO_MD5
OPENSSL_NO_MDC2
OPENSSL_NO_RC2
OPENSSL_NO_RC4
OPENSSL_NO_RC5
OPENSSL_NO_RIPEMD
OPENSSL_NO_RMD160
OPENSSL_NO_RSA
OPENSSL_NO_SHA
OPENSSL_NO_SHA0
OPENSSL_NO_SHA1
OPENSSL_NO_SOCK
OPENSSL_NO_SPEED
OPENSSL_NO_SSL2
OPENSSL_NO_STACK
OPENSSL_NO_STDIO
OPENSSL_NO_X509
OPENSSL_SYSNAME_WIN32
OPENSSL_SYS_AIX
OPENSSL_SYS_CRAY
OPENSSL_SYS_LINUX
OPENSSL_SYS_MACINTOSH_CLASSIC
OPENSSL_SYS_MACOSX
OPENSSL_SYS_MACOSX_RHAPSODY
OPENSSL_SYS_MPE
OPENSSL_SYS_MSDOS
OPENSSL_SYS_NEWS4
OPENSSL_SYS_OS2
OPENSSL_SYS_SNI
OPENSSL_SYS_SUNOS
OPENSSL_SYS_ULTRASPARC
OPENSSL_SYS_VMS
OPENSSL_SYS_VMS_DECC
OPENSSL_SYS_VMS_DECCXX  
OPENSSL_SYS_VMS_NODECC
OPENSSL_SYS_VXWORKS
OPENSSL_SYS_WIN16
OPENSSL_SYS_WIN32
OPENSSL_SYS_WIN32_CYGWIN
OPENSSL_SYS_WIN32_UWIN  
OPENSSL_SYS_WINCE
OPENSSL_SYS_WINDOWS
OPENSSL_SYS_WINNT
PEDANTIC
VMS
WIN16
WIN32
WINDOWS
_NEXT_SOURCE
__DJGPP__
__EMX__
__QNX__
__SVR4
__svr4__
__ultrix
sgi
sun
EOF

$unifdef1 = <<EOF;
OPENSSL_NO_KRB5
TERMIOS
EOF

$unifdef0 =~ s/\n$//;
$unifdef0 =~ s/^/-U/;
$unifdef0 =~ s/\n/\n-U/g;
$unifdef0 =~ s/\n/ /g;
$unifdef0 =~ join("\n", $unifdef);
$unifdef1 =~ s/\n$//;
$unifdef1 =~ s/^/-D/;
$unifdef1 =~ s/\n/\n-D/g;
$unifdef1 =~ s/\n/ /g;
$unifdef1 =~ join("\n", $unifdef);
$unifdef = $unifdef0 . ' ' . $unifdef1;
$unifdef = $unifdef0;

$files = `find . -name \\\*.h -type f -print | grep -v MacOS`;
foreach $i (split(/[\n ]/, $files)) {
	print "echo $i\n";
	print "unifdef $unifdef <$i >$tmp\n";
	print "mv $tmp $i\n";
}
